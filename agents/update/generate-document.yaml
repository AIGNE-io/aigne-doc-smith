name: generateDocument
description: Comprehensive content generator for documentation that creates detailed, high-quality document content from various data sources with intelligent analysis.
instructions:
  url: ../../prompts/detail/generate-document.md
input_schema:
  type: object
  properties:
    rules:
      type: string
      description: User's content generation rules and requirements
    locale:
      type: string
      description: User language, such as zh, en
    datasources:
      type: string
      description: Source data and context for document content generation
    targetAudience:
      type: string
      description: Target audience for document content
    nodeName:
      type: string
      description: Document node name for content generation
    originalDocumentStructure: ../schema/document-structure.yaml
    title:
      type: string
    description:
      type: string
    path:
      type: string
    parentId:
      type:
        - string
        - "null"
    glossary:
      type: string
      description: Glossary
    additionalInformation:
      type: string
      description: Additional supplementary information
  required:
    - rules
    - datasources
    - originalDocumentStructure
output_key: content
skills:
  - fs-tools/glob.mjs
  - fs-tools/grep.mjs
  - fs-tools/read-file.mjs
  - type: team
    task_render_mode: collapse
    name: generateDiagram
    skills:
      - ../generate/draw-diagram.yaml
      - ../generate/wrap-diagram-code.mjs
    reflection:
      reviewer: ../generate/check-diagram.mjs
      is_approved: isValid
      max_iterations: 5
      return_last_on_max_iterations: false
      custom_error_message: "MUST NOT generate any diagram: validation failed after max iterations."
    input_schema:
      type: object
      properties:
        documentContent:
          type: string
          description: |
            当前文档的**原始文本内容**。模型应根据这个文档中包含的**流程、结构、概念或关系**，生成相应的 D2 图表。
            **注意：** 此内容是原始文档，**不包含**任何已有的图表源代码。
      required:
        - documentContent
    output_schema:
      type: object
      properties:
        d2SourceCode:
          type: string
          description: |
            根据输入文本内容生成的 **D2 图表源代码**。
            **重要：** 返回的内容必须是**完整的、可直接渲染的 D2 格式**，例如，用于表示流程图、架构图或实体关系图等。
