type: team
task_render_mode: collapse
name: generateDiagram
skills:
  # Step 1: Analyze document content to determine diagram type and style
  - ../create/analyze-diagram-type.mjs
  # Step 2: Transform output for image generation agent
  - ../create/transform-for-image-generation.mjs
  # Step 3: Generate diagram image directly with unified agent
  - type: agent
    url: ../create/generate-diagram-image.yaml
  # Step 4: Replace placeholder with generated image
  - ../create/replace-d2-with-image.mjs
input_schema:
  type: object
  properties:
    documentContent:
      type: string
      description: The **raw text content** of the current document. (**Note:** This is the original document and **does not include** any diagram source code.)
    locale:
      type: string
      description: Language for diagram labels and text
      default: en
    diagramming:
      type: object
      description: Diagramming configuration including available styles
      properties:
        styles:
          type: array
          description: Available diagram styles configured by user
          items:
            type: string
        types:
          type: array
          description: Supported diagram types (optional, for reference)
          items:
            type: string
    feedback:
      type: string
      description: User feedback that may contain style or type preferences, or diagram index (e.g., 'use anthropomorphic style', 'update the second diagram')
      default: ""
    originalContent:
      type: string
      description: Original document content before modifications. Used to find existing diagrams when updating (may contain DIAGRAM_IMAGE_START, ```d2, or ```mermaid code blocks)
    diagramIndex:
      type: number
      description: Index of the diagram to replace (0-based). If not provided, will try to extract from feedback.
    path:
      type: string
      description: Document path (e.g., "guides/getting-started.md") used for generating image filename
    docsDir:
      type: string
      description: Documentation directory where assets will be saved (relative to project root)
  required:
    - documentContent
output_schema:
  type: object
  properties:
    content:
      type: string
      description: The document content with D2 code blocks replaced by generated diagram image.
  required:
    - content
