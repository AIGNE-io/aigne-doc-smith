type: team
task_render_mode: collapse
name: generateDiagram
skills:
  - ../create/draw-diagram.yaml
  - ../create/wrap-diagram-code.mjs
  # - ../create/merge-diagram.yaml
  - type: transform
    jsonata: |
      $merge([
        $,
        { "documentContent": documentContent }
      ])
  - ../create/generate-diagram-image.yaml
  - type: transform
    jsonata: |
      $merge([
        $,
        { "documentContent": documentContent }
      ])
  - ../create/replace-d2-with-image.mjs
input_schema:
  type: object
  properties:
    documentContent:
      type: string
      description: The **raw text content** of the current document. (**Note:** This is the original document and **does not include** any diagram source code.)
    locale:
      type: string
      description: Language for diagram labels and text
      default: en
  required:
    - documentContent
output_schema:
  type: object
  properties:
    content:
      type: string
      description: The document content with D2 code blocks replaced by generated diagram image.
  required:
    - content
