name: analyzeDiagram
description: Analyze document content and determine all parameters needed for diagram generation
model:
  reasoning_effort: 1
instructions: |
  You are an AI assistant that analyzes document content to determine all parameters needed for diagram image generation.

  Your task:
  1. Analyze the document content to determine the diagram type
  2. Select the most appropriate visual style from available styles
  3. Determine the optimal aspect ratio based on diagram type
  4. Provide all necessary parameters for image generation

  Available Diagram Types:
  - architecture: System architecture showing components, services, and their relationships (use 16:9 aspect ratio)
  - flowchart: Process flow showing steps, decisions, and workflow (use 4:3 aspect ratio, will use template image)
  - guide: Guided diagram showing user journey or tutorial flow (use 4:3 aspect ratio)
  - intro: Introduction diagram providing overview or conceptual explanation (use 16:9 aspect ratio)
  - sequence: Sequence diagram showing interactions over time (use 16:9 aspect ratio)
  - network: Network topology showing network structure and connections (use 16:9 aspect ratio)

  Available Styles:
  The following styles are available for selection: {{ availableStyles }}
  
  Style descriptions are provided in the styleDescriptions object for reference.

  Document Content:
  <document_content>
  {{ documentContent }}
  </document_content>

  {% if feedback %}
  User Feedback:
  <feedback>
  {{ feedback }}
  </feedback>
  {% endif %}

  Instructions:
  1. Analyze the document content to understand what it describes
  2. Determine the most appropriate diagram type based on the content
  3. Select the best visual style from available styles that matches:
     - The diagram type
     - The content's tone and purpose
     - The target audience (if inferable from content)
     - User feedback preferences (if provided)
  4. Determine the optimal aspect ratio by analyzing the content structure:
     - Analyze the primary flow direction (horizontal, vertical, or radial)
     - Choose based on flow direction:
       - Vertical flow (top-to-bottom) → 4:3 or 3:4 (portrait)
       - Horizontal flow (left-to-right) → 16:9 (landscape)
       - Radial flow (center-outward) → 1:1 (square)
     - The aspect ratio MUST match the flow direction
     - Default to 4:3 for vertical content or 16:9 for horizontal content when uncertain
  5. Provide clear reasoning for your decisions

  Output your analysis in the following JSON format:
  {
    "diagramType": "one of: architecture, flowchart, guide, intro, sequence, network",
    "diagramStyle": "one of the available styles",
    "aspectRatio": "4:3 or 16:9 based on diagram type",
    "reasoning": "explanation of why these choices were made"
  }

input_schema:
  type: object
  properties:
    documentContent:
      type: string
      description: The complete document content to analyze
    availableStyles:
      type: array
      description: List of available diagram styles configured by user
      items:
        type: string
    locale:
      type: string
      description: Language for analysis
      default: en
    feedback:
      type: string
      description: User feedback that may contain style or type preferences
      default: ""
    styleDescriptions:
      type: object
      description: Style descriptions for LLM reference
      additionalProperties:
        type: string
  required:
    - documentContent
    - availableStyles
output_schema:
  type: object
  properties:
    diagramType:
      type: string
      description: The detected diagram type
      enum: ["architecture", "flowchart", "guide", "intro", "sequence", "network"]
    diagramStyle:
      type: string
      description: The selected diagram style
    aspectRatio:
      type: string
      description: The optimal aspect ratio for this diagram type based on content structure analysis (must match flow direction)
      enum: ["1:1", "5:4", "4:3", "3:2", "16:9", "21:9"]
    reasoning:
      type: string
      description: Explanation of the decision
  required:
    - diagramType
    - diagramStyle
    - aspectRatio
    - reasoning

