# 质量保证

为确保所有生成的文档清晰、实用且专业，DocSmith 包含一个自动化的质量保证流程。此流程会对 Markdown 内容运行一系列检查，以便在发布前检测并报告常见问题，从损坏的链接到格式错误的图表。

该自动化管道会验证内容结构、链接、媒体和语法，以保持高标准的质量。

```d2
direction: down

"输入：Markdown 内容": {
  shape: document
}

"质量保证管道": {
  shape: package
  grid-columns: 1
  grid-gap: 50

  "结构检查": {
    shape: rectangle
    grid-columns: 2
    "完整性": "确保内容不被截断"
    "代码块": "验证块语法和缩进"
  }

  "内容验证": {
    shape: rectangle
    grid-columns: 2
    "链接完整性": "验证内部链接"
    "图片路径": "检查本地图片是否存在"
    "表格格式": "匹配列数"
  }

  "语法验证": {
    shape: rectangle
    grid-columns: 1
    "D2 图表": "验证 D2 语法"
    "Markdown Linting": "强制执行样式规则"
  }
}

"输出：已验证内容或错误报告": {
  shape: document
}

"输入：Markdown 内容" -> "质量保证管道"
"质量保证管道" -> "输出：已验证内容或错误报告"
```

### 核心验证领域

DocSmith 的质量保证流程涵盖了几个关键领域，以确保文档的完整性。

#### 内容结构与完整性

DocSmith 执行多项检查以确保内容的结构完整性：

- **未闭合的代码块**：检测以 ` ``` ` 开头但未闭合的代码块。
- **缺失换行符**：识别显示在单行上的内容，这可能表示缺少换行符。
- **正确的结尾**：验证内容是否以适当的标点符号（例如 `.`、`)`、`|`、`>`）结尾，以防止输出被截断。

#### 链接完整性

文档中的所有相对链接都会根据项目的 `structurePlan` 进行验证，以防止出现死链接。这确保了所有内部导航都能正常工作。检查器会忽略外部链接（以 `http://` 或 `https://` 开头）和 `mailto:` 链接。

#### 图片和媒体验证

为避免图片损坏，检查器会验证文档中引用的任何本地图片是否存在于文件系统中。它会解析相对路径和绝对路径，以确认文件存在。外部图片 URL 和数据 URL 不会被检查。

#### 图表语法验证

DocSmith 会验证 D2 图表语法以确保其正确渲染。每个 `d2` 代码块都会被处理，以确认其可以成功渲染为 SVG 图像，从而提前捕获任何语法错误。

#### 表格格式

检查器会检查表格中一个常见的格式错误：表头、分隔线和数据行的列数不匹配。此检查可确保表格在所有 Markdown 解析器中都能正确渲染。

#### 代码块格式

检查器会分析代码块以检测不一致的缩进。如果代码块中的某一行缩进少于开头的 ` ``` ` 标记，可能会导致渲染问题。此检查有助于保持代码的可读性和呈现效果。

#### Markdown 格式和 Linting

内置的 linter 会强制执行一致且有效的 Markdown 结构，这有助于防止渲染问题并提高可读性。关键规则包括：

| Rule ID | Description |
|---|---|
| `no-duplicate-headings` | 防止在同一部分中出现内容相同的多个标题。 |
| `no-undefined-references` | 确保所有链接和图片引用都已定义。 |
| `no-heading-content-indent` | 禁止在标题内容前缩进。 |
| `no-multiple-toplevel-headings` | 每个文档只允许一个顶级标题 (H1)。 |
| `code-block-style` | 为代码块强制执行一致的样式（例如，使用反引号）。 |

通过自动化这些检查，DocSmith 有助于保持高质量标准，确保最终的文档准确、可靠且易于最终用户导航。

要了解有关整体架构的更多信息，请参阅 [工作原理](./advanced-how-it-works.md) 部分。